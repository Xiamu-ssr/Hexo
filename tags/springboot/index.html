<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta name="theme-color" content="#123456"><title>标签: springboot - Hexo</title><link rel="manifest" href="/Hexo/manifest.json"><meta name="theme-color" content="#1E1E1E"><meta name="application-name" content="夏木的个人博客-记录"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#1E1E1E"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="夏木的个人博客-记录"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://xiamu-ssr.github.io/Hexo"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiamu-ssr.github.io/Hexo/img/og_image.png"><meta property="article:author" content="Xiamu"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://xiamu-ssr.github.io/Hexo/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiamu-ssr.github.io/Hexo"},"headline":"Hexo","image":["https://xiamu-ssr.github.io/Hexo/img/og_image.png"],"author":{"@type":"Person","name":"Xiamu"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"https://xiamu-ssr.github.io/img/logo.svg"}},"description":""}</script><link rel="icon" href="/Hexo/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/Hexo/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/Hexo/"><img src="/Hexo/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/Hexo/">Home</a><a class="navbar-item" href="/Hexo/archives">Archives</a><a class="navbar-item" href="/Hexo/categories">Categories</a><a class="navbar-item" href="/Hexo/tags">Tags</a><a class="navbar-item" href="/Hexo/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Xiamu-ssr/Hexo"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/Hexo/tags">标签</a></li><li class="is-active"><a href="#" aria-current="page">springboot</a></li></ul></nav></div></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2024/02/16/2024-H1/2024-02-16-23-01-49/"><img class="fill" src="/Hexo/2024/02/16/2024-H1/2024-02-16-23-01-49/1718889284942.png" alt="Spring AMQP(3.1.1)设置ConfirmCallback和ReturnsCallback"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-16T23:01:49.000Z" title="2/16/2024, 11:01:49 PM">2024-02-16</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.350Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringCloud/">SpringCloud</a><span> / </span><a class="link-muted" href="/Hexo/categories/SpringCloud/RabbitMQ/">RabbitMQ</a></span><span class="level-item">5 分钟读完 (大约752个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2024/02/16/2024-H1/2024-02-16-23-01-49/">Spring AMQP(3.1.1)设置ConfirmCallback和ReturnsCallback</a></p><div class="content"><p>环境如下</p>
<table>
<thead>
<tr>
<th></th>
<th>Version</th>
</tr>
</thead>
<tbody><tr>
<td>SpringBoot</td>
<td>3.2.1</td>
</tr>
<tr>
<td>spring-amqp</td>
<td>3.1.1</td>
</tr>
<tr>
<td>RabbitMq</td>
<td>3-management</td>
</tr>
</tbody></table>
<h1 id="一、起因"><a href="#一、起因" class="headerlink" title="一、起因"></a>一、起因</h1><p>老版本的<code>spring-amqp</code>在<code>CorrelationData</code>上设置<code>ConfirmCallback</code>。但是今天却突然发现<code>correlationData.getFuture()</code>没有<code>addCallback</code>函数了。</p>
<p>查询文档和帖子后，发现<code>ConfirmCallback</code>和<code>ReturnsCallback</code>都需要在<code>RabbitTemplate</code>中设置，同时<code>ConfirmCallback</code>中默认无法得到消息内容，如果想在<code>ConfirmCallback</code>中把消息内容存到数据库等地方进行记录，怎么办呢？</p>
<p>参考手册</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-amqp/reference/amqp/template.html#template-confirms">Spring AMQP 3.1.1</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp/rabbit/core/RabbitTemplate.ConfirmCallback.html">Spring AMQP 3.1.1 API</a></li>
</ul>
<h1 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h1><h2 id="1-定义exchange和queue"><a href="#1-定义exchange和queue" class="headerlink" title="1. 定义exchange和queue"></a>1. 定义exchange和queue</h2><figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Configuration</span><br><span class="line">public class PayNotifyConfig&#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    //交换机</span><br><span class="line">    public static final String PAYNOTIFY_EXCHANGE_FANOUT = &quot;paynotify_exchange_fanout&quot;;</span><br><span class="line">    //支付通知队列</span><br><span class="line">    public static final String PAYNOTIFY_QUEUE = &quot;paynotify_queue&quot;;</span><br><span class="line">    //支付结果通知消息类型</span><br><span class="line">    public static final String MESSAGE_TYPE = &quot;payresult_notify&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //声明交换机，且持久化</span><br><span class="line">    @Bean(PAYNOTIFY_EXCHANGE_FANOUT)</span><br><span class="line">    public FanoutExchange paynotify_exchange_fanout() &#123;</span><br><span class="line">   </span><br><span class="line">        // 三个参数：交换机名称、是否持久化、当没有queue与其绑定时是否自动删除</span><br><span class="line">        return new FanoutExchange(PAYNOTIFY_EXCHANGE_FANOUT, true, false);</span><br><span class="line">    &#125;</span><br><span class="line">    //支付通知队列,且持久化</span><br><span class="line">    @Bean(PAYNOTIFY_QUEUE)</span><br><span class="line">    public Queue paynotify_queue() &#123;</span><br><span class="line">   </span><br><span class="line">        return QueueBuilder.durable(PAYNOTIFY_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //交换机和支付通知队列绑定</span><br><span class="line">    @Bean</span><br><span class="line">    public Binding binding_paynotify_queue(@Qualifier(PAYNOTIFY_QUEUE) Queue queue, @Qualifier(PAYNOTIFY_EXCHANGE_FANOUT) FanoutExchange exchange) &#123;</span><br><span class="line">   </span><br><span class="line">        return BindingBuilder.bind(queue).to(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-RabbitTemplate"><a href="#2-RabbitTemplate" class="headerlink" title="2. RabbitTemplate"></a>2. RabbitTemplate</h2><p>在上面的类中继续添加<code>RabbitTemplate</code> ，并设置<code>ConfirmCallback</code>和<code>ReturnsCallback</code>。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">   public RabbitTemplate rabbitTemplate(final ConnectionFactory connectionFactory) &#123;</span><br><span class="line">  </span><br><span class="line">       final RabbitTemplate rabbitTemplate = new RabbitTemplate(connectionFactory);</span><br><span class="line">       //设置confirm callback</span><br><span class="line">       rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -&gt; &#123;</span><br><span class="line">  </span><br><span class="line">           String body = &quot;1&quot;;</span><br><span class="line">           if (correlationData instanceof EnhancedCorrelationData) &#123;</span><br><span class="line">  </span><br><span class="line">               body = ((EnhancedCorrelationData) correlationData).getBody();</span><br><span class="line">           &#125;</span><br><span class="line">           if (ack) &#123;</span><br><span class="line">  </span><br><span class="line">               //消息投递到exchange</span><br><span class="line">               log.debug(&quot;消息发送到exchange成功:correlationData=&#123;&#125;,message_id=&#123;&#125; &quot;, correlationData, body);</span><br><span class="line">               System.out.println(&quot;消息发送到exchange成功:correlationData=&#123;&#125;,message_id=&#123;&#125;&quot;+correlationData+body);</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">  </span><br><span class="line">               log.debug(&quot;消息发送到exchange失败:cause=&#123;&#125;,message_id=&#123;&#125;&quot;,cause, body);</span><br><span class="line">               System.out.println(&quot;消息发送到exchange失败:cause=&#123;&#125;,message_id=&#123;&#125;&quot;+cause+body);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       </span><br><span class="line">       //设置return callback</span><br><span class="line">       rabbitTemplate.setReturnsCallback(returned -&gt; &#123;</span><br><span class="line">  </span><br><span class="line">           Message message = returned.getMessage();</span><br><span class="line">           int replyCode = returned.getReplyCode();</span><br><span class="line">           String replyText = returned.getReplyText();</span><br><span class="line">           String exchange = returned.getExchange();</span><br><span class="line">           String routingKey = returned.getRoutingKey();</span><br><span class="line">           // 投递失败，记录日志</span><br><span class="line">           log.error(&quot;消息发送失败，应答码&#123;&#125;，原因&#123;&#125;，交换机&#123;&#125;，路由键&#123;&#125;,消息&#123;&#125;&quot;,</span><br><span class="line">                   replyCode, replyText, exchange, routingKey, message.toString());</span><br><span class="line">       &#125;);</span><br><span class="line">       return rabbitTemplate;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-EnhancedCorrelationData"><a href="#3-EnhancedCorrelationData" class="headerlink" title="3. EnhancedCorrelationData"></a>3. EnhancedCorrelationData</h2><p>原始的<code>CorrelationData</code>，目前已经无法从中获取消息内容，也就是说现在的<code>ConfirmCallback</code>无法获取到消息的内容，因为设计上只关注是否投递到<code>exchange</code>成功。如果需要在<code>ConfirmCallback</code>中获取消息的内容，需要扩展这个类，并在发消息的时候，放入自定义数据。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class EnhancedCorrelationData extends CorrelationData &#123;</span><br><span class="line">   </span><br><span class="line">    private final String body;</span><br><span class="line"></span><br><span class="line">    public EnhancedCorrelationData(String id, String body) &#123;</span><br><span class="line">   </span><br><span class="line">        super(id);</span><br><span class="line">        this.body = body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBody() &#123;</span><br><span class="line">   </span><br><span class="line">        return body;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-发送消息"><a href="#4-发送消息" class="headerlink" title="4. 发送消息"></a>4. 发送消息</h2><p>在<code>EnhancedCorrelationData</code>把消息本身放进去，或者如果你有表记录消息，你可以只放入其<code>id</code>。这样触发ConfirmCallback的时候，就可以获取消息内容。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public void notifyPayResult() &#123;</span><br><span class="line"> </span><br><span class="line">String message = &quot;TEST Message&quot;;</span><br><span class="line">      Message message1 = MessageBuilder.withBody(message.getBytes(StandardCharsets.UTF_8))</span><br><span class="line">              .setDeliveryMode(MessageDeliveryMode.PERSISTENT)</span><br><span class="line">              .build();</span><br><span class="line">      CorrelationData correlationData = new EnhancedCorrelationData(UUID.randomUUID().toString(), message.toString());</span><br><span class="line">      rabbitTemplate.convertAndSend(PayNotifyConfig.PAYNOTIFY_EXCHANGE_FANOUT,&quot;&quot;, message1, correlationData);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<img src="/Hexo/2024/02/16/2024-H1/2024-02-16-23-01-49/1718889284942.png" class="" title="This is an example image">

</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2024/02/08/2024-H1/2024-02-08-17-35-27/"><img class="fill" src="/Hexo/2024/02/08/2024-H1/2024-02-08-17-35-27/1718889358978.png" alt="从RSA角度出发解析JWT原理"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-08T17:35:27.000Z" title="2/8/2024, 5:35:27 PM">2024-02-08</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.314Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringCloud/">SpringCloud</a><span> / </span><a class="link-muted" href="/Hexo/categories/SpringCloud/%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83/">认证授权</a></span><span class="level-item">10 分钟读完 (大约1553个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2024/02/08/2024-H1/2024-02-08-17-35-27/">从RSA角度出发解析JWT原理</a></p><div class="content"><p>在今天的数字化世界中，安全地传递信息变得越来越重要。<code>JSON Web Token</code>（<code>JWT</code>）作为一种流行的开放标准，为简化服务器与客户端之间的安全交流提供了一种高效的方式。本文旨在深入解析<code>JWT</code>的工作原理，并通过示例演示如何使用<code>JWT</code>进行安全通信。我们将从<code>JWT</code>的基本组成部分讲起，探讨公密钥加密的原理，解释为什么<code>JWT</code>是安全的，以及如何验证<code>JWT</code>的有效性。</p>
<h1 id="一、JWT介绍"><a href="#一、JWT介绍" class="headerlink" title="一、JWT介绍"></a>一、JWT介绍</h1><h2 id="1-JWT组成部分"><a href="#1-JWT组成部分" class="headerlink" title="1. JWT组成部分"></a>1. JWT组成部分</h2><p>JWT由三个部分组成，它们分别是头部（Header）、载荷（Payload）、和签名（Signature）。通过将这三部分用点（<code>.</code>）连接起来，形成了一个完整的JWT字符串。例如：<code>xxxxx.yyyyy.zzzzz</code>。</p>
<h2 id="2-头部（Header）"><a href="#2-头部（Header）" class="headerlink" title="2. 头部（Header）"></a>2. 头部（Header）</h2><p>头部通常由两部分组成：令牌类型（<code>typ</code>）和签名算法（<code>alg</code>）。例如：</p>
<figure class="highlight plaintext"><figcaption><span>language-json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">  &quot;kid&quot;: &quot;33bd1cad-62a6-4415-89a6-c2c816f3d3b1&quot;,</span><br><span class="line">  &quot;alg&quot;: &quot;RS256&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>kid (Key ID)</code>：密钥标识符，用于指明验证JWT签名时使用的密钥。在含有多个密钥的系统中，这可以帮助接收者选择正确的密钥进行验证。这里的值33bd1cad-62a6-4415-89a6-c2c816f3d3b1是一个UUID，唯一标识了用于签名的密钥。</li>
<li><code>alg (Algorithm)</code>：指明用于签名的算法，这里是RS256，表示使用RSA签名算法和SHA-256散列算法。这种算法属于公钥&#x2F;私钥算法，意味着使用私钥进行签名，而用公钥进行验证。</li>
</ul>
<h2 id="3-载荷（Payload）"><a href="#3-载荷（Payload）" class="headerlink" title="3. 载荷（Payload）"></a>3. 载荷（Payload）</h2><p>载荷包含了所要传递的信息，这些信息以声明（claims）的形式存在。声明可以是用户的身份标识，也可以是其他任何必要的信息。载荷示例：</p>
<figure class="highlight plaintext"><figcaption><span>language-json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">  &quot;sub&quot;: &quot;XcWebApp&quot;,</span><br><span class="line">  &quot;aud&quot;: &quot;XcWebApp&quot;,</span><br><span class="line">  &quot;nbf&quot;: 1707373072,</span><br><span class="line">  &quot;iss&quot;: &quot;http://localhost:63070/auth&quot;,</span><br><span class="line">  &quot;exp&quot;: 1707380272,</span><br><span class="line">  &quot;iat&quot;: 1707373072,</span><br><span class="line">  &quot;jti&quot;: &quot;62e885c5-6b3f-49a2-aa10-b2e872a52b33&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>sub (Subject)</code>：主题，标识了这个JWT的主体，通常是指用户的唯一标识。这里XcWebApp可能是一个应用或用户标识。</li>
<li><code>aud (Audience)</code>：受众，标识了这个JWT的预期接收者。这里同样是XcWebApp，意味着这个JWT是为XcWebApp这个应用或服务生成的。</li>
<li><code>nbf (Not Before)</code>：生效时间，这个时间之前，JWT不应被接受处理。这里的时间是Unix时间戳格式，表示JWT生效的具体时间。</li>
<li><code>iss (Issuer)</code>：发行者，标识了这个JWT的发行方。这里是<a target="_blank" rel="noopener" href="http://localhost:63070/auth%EF%BC%8C%E8%A1%A8%E6%98%8EJWT%E7%94%B1%E6%9C%AC%E5%9C%B0%E7%9A%84%E6%9F%90%E4%B8%AA%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E8%A1%8C%E3%80%82">http://localhost:63070/auth，表明JWT由本地的某个认证服务器发行。</a></li>
<li><code>exp (Expiration Time)</code>：过期时间，这个时间之后，JWT不再有效。同样是Unix时间戳格式，表示JWT过期的具体时间。</li>
<li><code>iat (Issued At)</code>：发行时间，JWT创建的时间。这提供了JWT的时间信息，也是Unix时间戳格式。</li>
<li><code>jti (JWT ID)</code>：JWT的唯一标识符，用于防止JWT被重放（即两次使用同一个JWT）。这里的值是一个UUID，确保了JWT的唯一性。</li>
</ul>
<h2 id="4-签名（Signature）"><a href="#4-签名（Signature）" class="headerlink" title="4. 签名（Signature）"></a>4. 签名（Signature）</h2><p>签名是对头部和载荷的加密保护，确保它们在传输过程中未被篡改。根据头部中指定的算法（例如HS256），使用<code>私钥</code>对头部和载荷进行签名。</p>
<h1 id="二、深入理解JWT签名验证"><a href="#二、深入理解JWT签名验证" class="headerlink" title="二、深入理解JWT签名验证"></a>二、深入理解JWT签名验证</h1><h2 id="1-签名生成"><a href="#1-签名生成" class="headerlink" title="1. 签名生成"></a>1. 签名生成</h2><ol>
<li><strong>哈希处理</strong> ：首先对JWT的<code>头部和载荷</code>部分（经过Base64编码并用.连接的字符串）进行哈希处理，生成一个哈希值。这个步骤是为了确保数据的完整性，即使是微小的改动也会导致哈希值有很大的不同。</li>
<li><strong>私钥加密哈希值</strong> ：然后使用发行者的<code>私钥</code>对这个<code>哈希值</code>进行加密，生成的结果就是JWT的签名部分。这个加密的哈希值（签名）附加在JWT的后面。</li>
</ol>
<h2 id="2-签名验证"><a href="#2-签名验证" class="headerlink" title="2. 签名验证"></a>2. 签名验证</h2><ol>
<li><strong>哈希处理</strong> ：接收方收到JWT后，会独立地对其头部和载荷部分进行<code>同样的哈希</code>处理，生成一个哈希值。</li>
<li><strong>公钥解密签名</strong> ：接收方使用发行者的<code>公钥</code>对签名（加密的哈希值）进行<code>解密</code>，得到另一个哈希值。</li>
<li><strong>哈希值比较</strong> ：<code>比较这两个哈希值</code>。如果它们相同，就证明了JWT在传输过程中未被篡改，因为只有相应的私钥能够生成一个对应的、能够通过公钥解密并得到原始哈希值的签名。</li>
</ol>
<h2 id="3-为什么JWT是安全的"><a href="#3-为什么JWT是安全的" class="headerlink" title="3. 为什么JWT是安全的"></a>3. 为什么JWT是安全的</h2><p>由于破解RSA算法的难度极高，没有私钥就无法生成有效的签名，因此无法伪造签名。这就是为什么使用公钥进行签名验证是安全的原因。</p>
<h1 id="三、如何验证JWT是否有效"><a href="#三、如何验证JWT是否有效" class="headerlink" title="三、如何验证JWT是否有效"></a>三、如何验证JWT是否有效</h1><p>对于一个JWT，我们可以使用Base64解码，获取前两部分信息，可以进行token是否<code>过期</code>等验证，具体取决于前两部分具体内容，这是可以人为设置的。<br>对于签名部分，可以用公钥去验证其<code>有效</code>性（即是否被纂改）。</p>
<h1 id="四、-Why-JWT？"><a href="#四、-Why-JWT？" class="headerlink" title="四、 Why JWT？"></a>四、 Why JWT？</h1><p>为什么是JWT？<br>首先是<code>不可伪造的安全性</code>，其次，因为你会发现，只要有公钥就可以验证JWT这种token，这也就意味着对于微服务来说，任意微服务都有能力自行验证JWT，而不需要额外的验证模块。这种自校验没有用到网络通信，<code>性能十分好</code>。同时，JWT有<code>时间限制</code>，一定程度上也提高了最坏情况的安全性。</p>
<img src="/Hexo/2024/02/08/2024-H1/2024-02-08-17-35-27/1718889358978.png" class="" title="This is an example image">

</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2024/01/27/2024-H1/2024-01-27-16-26-19/"><img class="fill" src="/Hexo/2024/01/27/2024-H1/2024-01-27-16-26-19/1718889433254.png" alt="spring-boot-starter-validation常用注解"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-01-27T16:26:19.000Z" title="1/27/2024, 4:26:19 PM">2024-01-27</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.266Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringBoot3/">SpringBoot3</a></span><span class="level-item">12 分钟读完 (大约1742个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2024/01/27/2024-H1/2024-01-27-16-26-19/">spring-boot-starter-validation常用注解</a></p><div class="content"><h1 id="一、使用"><a href="#一、使用" class="headerlink" title="一、使用"></a>一、使用</h1><p>要使用这些注解，首先确保在你的 Spring Boot 应用的 <code>pom.xml</code> 文件中添加了 <code>spring-boot-starter-validation</code> 依赖。然后，你可以将这些注解应用于你的模型类字段上。在你的控制器方法中，你可以使用 <code>@Valid</code> 或 <code>@Validated</code> 注解来触发验证，例如：</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/users&quot;)</span><br><span class="line">public ResponseEntity&lt;?&gt; createUser(@Valid @RequestBody User user) &#123;</span><br><span class="line">   </span><br><span class="line">    // 如果存在验证错误，会抛出异常</span><br><span class="line">    // 正常业务逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，如果 <code>User</code> 对象的字段不满足注解定义的验证规则，Spring 将抛出一个异常，你可以通过全局异常处理或控制器层的异常处理来处理这些异常，并向用户返回适当的响应。</p>
<h1 id="二、常用注解"><a href="#二、常用注解" class="headerlink" title="二、常用注解"></a>二、常用注解</h1><p><code>spring-boot-starter-validation</code> 依赖包引入了 Java Bean Validation API（通常基于 Hibernate Validator 实现），提供了一系列注解来帮助你对 Java 对象进行验证。以下是一些常用的验证注解及其含义和使用方式：</p>
<ol>
<li><p><strong>@NotNull</strong> : 确保字段不是 <code>null</code>。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @NotNull(message = &quot;用户名不能为空&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@NotEmpty</strong> : 确保字段既不是 <code>null</code> 也不是空（对于字符串意味着长度大于0，对于集合意味着至少包含一个元素）。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @NotEmpty(message = &quot;密码不能为空&quot;)</span><br><span class="line">    private String password;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@NotBlank</strong> : 确保字符串字段不是 <code>null</code> 且至少包含一个非空白字符。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @NotBlank(message = &quot;邮箱不能为空且不能只包含空格&quot;)</span><br><span class="line">    private String email;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Size</strong>: 确保字段（字符串、集合、数组）符合指定的大小范围。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @Size(min = 2, max = 30, message = &quot;用户名长度必须在2到30之间&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Min</strong> 和 <strong>@Max</strong>: 对数值类型字段设置最小值和最大值。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @Min(value = 18, message = &quot;年龄必须大于等于18&quot;)</span><br><span class="line">    @Max(value = 100, message = &quot;年龄必须小于等于100&quot;)</span><br><span class="line">    private int age;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Email</strong>: 确保字段是有效的电子邮件地址。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @Email(message = &quot;无效的邮箱格式&quot;)</span><br><span class="line">    private String email;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Pattern</strong>: 确保字符串字段匹配正则表达式。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">     </span><br><span class="line">    @Pattern(regexp = &quot;^[a-zA-Z0-9]+$&quot;, message = &quot;用户名只能包含字母和数字&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Positive</strong> 和 <strong>@PositiveOrZero</strong>: 确保数值字段是正数或者正数和零。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Product &#123;</span><br><span class="line">     </span><br><span class="line">    @Positive(message = &quot;价格必须是正数&quot;)</span><br><span class="line">    private BigDecimal price;</span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="三、-Valid-or-Validated-？"><a href="#三、-Valid-or-Validated-？" class="headerlink" title="三、@Valid or @Validated ？"></a>三、@Valid or @Validated ？</h1><p><code>@Valid</code> 和 <code>@Validated</code> 注解都用于数据验证，但它们在使用和功能上有一些差异：</p>
<ol>
<li><p><strong>@Valid</strong>:</p>
<ul>
<li>来源于 JSR 303&#x2F;JSR 380 Bean Validation API。</li>
<li>可以用在方法参数上，以触发对传递给该方法的对象的验证。这通常在 Spring MVC 中用于验证带有 <code>@RequestBody</code> 或 <code>@ModelAttribute</code> 注解的参数。</li>
<li>不支持验证组的概念，这意味着不能控制验证的顺序或验证特定的子集。</li>
</ul>
<p>示例：</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/users&quot;)</span><br><span class="line">public ResponseEntity&lt;?&gt; createUser(@Valid @RequestBody User user) &#123;</span><br><span class="line">     </span><br><span class="line">    // 业务逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Validated(推荐)</strong>:</p>
<ul>
<li>是 Spring 的特有注解，不是 JSR 303&#x2F;JSR 380 的一部分。</li>
<li>支持验证组，允许您更灵活地指定在特定情况下应用哪些验证约束。例如，可以根据不同的操作（如创建、更新）定义不同的验证规则。</li>
<li>可以用在类型级别（在类上）和方法参数上。在类型级别使用时，它会触发该类中所有带有验证注解的方法的验证。</li>
</ul>
<p>示例：</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/users&quot;)</span><br><span class="line">public ResponseEntity&lt;?&gt; createUser(@Validated @RequestBody User user) &#123;</span><br><span class="line">     </span><br><span class="line">    // 业务逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>在实际使用中，如果你需要简单的验证功能，<code>@Valid</code> 是一个很好的选择。如果你需要更复杂的验证逻辑，比如验证组，那么 <code>@Validated</code> 更适合。此外，<code>@Validated</code> 可以应用在类级别，从而对一个类的多个方法进行验证，这在使用 Spring 服务层时非常有用。</p>
<h1 id="四、分组校验"><a href="#四、分组校验" class="headerlink" title="四、分组校验"></a>四、分组校验</h1><p>分组校验（Group Validation）是一种在 Java Bean Validation 中用于在不同上下文中应用不同验证规则的方法。这对于那些在不同情况下（例如，创建 vs 更新）需要不同验证规则的对象特别有用。</p>
<h2 id="1-分组校验的基本概念"><a href="#1-分组校验的基本概念" class="headerlink" title="1. 分组校验的基本概念"></a>1. 分组校验的基本概念</h2><p>在分组校验中，你可以定义多个接口（通常为空）来表示不同的验证组。然后，你可以在验证注解中指定这些接口，以表明该注解仅在验证特定组时应用。</p>
<p>例如，你可能有一个<code>User</code>类，其中某些字段在创建用户时是必需的，但在更新用户时可能是可选的。</p>
<h2 id="2-定义验证组"><a href="#2-定义验证组" class="headerlink" title="2. 定义验证组"></a>2. 定义验证组</h2><p>首先，定义两个空接口作为验证组：</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface OnCreate &#123;</span><br><span class="line">   &#125;</span><br><span class="line">public interface OnUpdate &#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-应用分组到模型"><a href="#3-应用分组到模型" class="headerlink" title="3. 应用分组到模型"></a>3. 应用分组到模型</h2><p>然后，在你的模型类中使用这些接口作为验证注解的参数：</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    @NotNull(groups = OnCreate.class)</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    @NotBlank(groups = &#123;</span><br><span class="line">   OnCreate.class, OnUpdate.class&#125;)</span><br><span class="line">    private String username;</span><br><span class="line"></span><br><span class="line">    @Email(groups = &#123;</span><br><span class="line">   OnCreate.class, OnUpdate.class&#125;)</span><br><span class="line">    private String email;</span><br><span class="line"></span><br><span class="line">    // 其他字段和方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>id</code> 字段仅在创建用户时需要验证（<code>OnCreate</code>组），而 <code>username</code> 和 <code>email</code> 字段在创建和更新用户时都需要验证。</p>
<h2 id="4-在控制器中使用分组"><a href="#4-在控制器中使用分组" class="headerlink" title="4. 在控制器中使用分组"></a>4. 在控制器中使用分组</h2><p>最后，在你的控制器方法中，使用 <code>@Validated</code> 注解指定要应用的验证组：</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/users&quot;)</span><br><span class="line">public ResponseEntity&lt;?&gt; createUser(@Validated(OnCreate.class) @RequestBody User user) &#123;</span><br><span class="line">   </span><br><span class="line">    // 创建用户的业务逻辑</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@PutMapping(&quot;/users&quot;)</span><br><span class="line">public ResponseEntity&lt;?&gt; updateUser(@Validated(OnUpdate.class) @RequestBody User user) &#123;</span><br><span class="line">   </span><br><span class="line">    // 更新用户的业务逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>createUser</code> 方法只会验证属于 <code>OnCreate</code> 组的字段，而 <code>updateUser</code> 方法则只会验证属于 <code>OnUpdate</code> 组的字段。这样，你就可以根据不同的操作自定义验证逻辑了。</p>
<h2 id="5-默认组如何总是被校验"><a href="#5-默认组如何总是被校验" class="headerlink" title="5. 默认组如何总是被校验"></a>5. 默认组如何总是被校验</h2><p>当字段没有指定<code>groups</code>时，属于默认组，当<code>@Validated(OnUpdate.class)</code>指定了特定的组后，属于默认组的字段将不再被校验，一个个都加上<code>groups</code>太麻烦，如何让默认组字段总是被校验呢？<br>如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import jakarta.validation.groups.Default;</span><br><span class="line">public interface OnCreate extends Default&#123;</span><br><span class="line">   &#125;</span><br><span class="line">public interface OnUpdate extends Default&#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2><p>通过使用分组校验，你可以为同一个对象的不同操作设置不同的验证规则，这在复杂应用中非常有用。这种方法提高了代码的灵活性和可维护性。</p>
<img src="/Hexo/2024/01/27/2024-H1/2024-01-27-16-26-19/1718889433254.png" class="" title="This is an example image">

</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2024/01/23/2024-H1/2024-01-23-17-28-37/"><img class="fill" src="/Hexo/gallery/defaultCover3.png" alt="SpringBoot3整合MyBatisPlus"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-01-23T17:28:37.000Z" title="1/23/2024, 5:28:37 PM">2024-01-23</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.250Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringBoot3/">SpringBoot3</a><span> / </span><a class="link-muted" href="/Hexo/categories/SpringBoot3/MyBatisPlus/">MyBatisPlus</a></span><span class="level-item">1 分钟读完 (大约187个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2024/01/23/2024-H1/2024-01-23-17-28-37/">SpringBoot3整合MyBatisPlus</a></p><div class="content"><h1 id="一、起因"><a href="#一、起因" class="headerlink" title="一、起因"></a>一、起因</h1><p>随着<code>SpringBoot3</code>的发布，<code>mybatisplus</code>也在不断更新以适配<code>spirngboot3</code> 。目前仍然处于维护升级阶段，最初<code>2023.08</code>时，官方宣布对<code>SpringBoot3</code>的原生支持，<a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus/issues/5527">详情看这里</a>。</p>
<p>但是对于较新版本的<code>SpringBoot3</code>，仍然有很多<code>bug</code>，甚至无法启动，摸爬滚打又游历社区后，实践后得到一套成功的版本搭配，具体如下</p>
<table>
<thead>
<tr>
<th></th>
<th>Version</th>
</tr>
</thead>
<tbody><tr>
<td>Java</td>
<td>17</td>
</tr>
<tr>
<td>Spring Boot</td>
<td>3.2.1</td>
</tr>
<tr>
<td>Spring Cloud</td>
<td>2023.0.0</td>
</tr>
<tr>
<td>Mybatis Plus</td>
<td><code>3.5.5</code></td>
</tr>
</tbody></table>
<h1 id="二、引入依赖"><a href="#二、引入依赖" class="headerlink" title="二、引入依赖"></a>二、引入依赖</h1><figure class="highlight plaintext"><figcaption><span>language-xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">             &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">             &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt;</span><br><span class="line">             &lt;version&gt;3.5.5&lt;/version&gt;</span><br><span class="line">         &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>同时官方也提供了<code>Demo</code>项目，<a target="_blank" rel="noopener" href="https://github.com/nieqiurong/mybatis-native-demo">详情看这里</a>，里面使用的版本搭配如下</p>
<table>
<thead>
<tr>
<th></th>
<th>Version</th>
</tr>
</thead>
<tbody><tr>
<td>Java</td>
<td>17</td>
</tr>
<tr>
<td>Spring Boot</td>
<td>3.2.0</td>
</tr>
<tr>
<td>Mybatis Plus</td>
<td>3.5.5-SNAPSHOT</td>
</tr>
</tbody></table>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/"><img class="fill" src="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/1718889438135.png" alt="SpringBoot3整合OpenAPI3(Swagger3)"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-01-23T17:14:08.000Z" title="1/23/2024, 5:14:08 PM">2024-01-23</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.250Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringBoot3/">SpringBoot3</a><span> / </span><a class="link-muted" href="/Hexo/categories/SpringBoot3/OpenAPI3/">OpenAPI3</a></span><span class="level-item">4 分钟读完 (大约567个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/">SpringBoot3整合OpenAPI3(Swagger3)</a></p><div class="content"><p><code>swagger2</code>更新到3后，再使用方法上发生了很大的变化，名称也变为<code>OpenAPI3</code>。</p>
<p><a target="_blank" rel="noopener" href="https://springdoc.org/">官方文档</a></p>
<h1 id="一、引入依赖"><a href="#一、引入依赖" class="headerlink" title="一、引入依赖"></a>一、引入依赖</h1><figure class="highlight plaintext"><figcaption><span>language-xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springdoc&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;springdoc-openapi.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><figcaption><span>language-yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /content</span><br><span class="line">springdoc:</span><br><span class="line">  api-docs:</span><br><span class="line">    enabled: true</span><br><span class="line">    path: /v3/api-docs</span><br><span class="line">  swagger-ui:</span><br><span class="line">    enabled: true</span><br><span class="line">    path: /swagger-ui.html</span><br></pre></td></tr></table></figure>

<p><code>openapi3</code>使用十分方便，做到这里后，你可以直接通过以下网址访问<code>swagger</code>页面。</p>
<figure class="highlight plaintext"><figcaption><span>language-html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://&lt;ip&gt;:&lt;port&gt;/content/swagger-ui/index.html</span><br></pre></td></tr></table></figure>

<img src="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/1718889437740.png" class="" title="This is an example image">

<h1 id="二、使用"><a href="#二、使用" class="headerlink" title="二、使用"></a>二、使用</h1><h2 id="1-OpenAPIDefinition-Info"><a href="#1-OpenAPIDefinition-Info" class="headerlink" title="1. @OpenAPIDefinition + @Info"></a>1. @OpenAPIDefinition + @Info</h2><p>用于定义整个 <code>API</code> 的信息，通常放在主应用类上。可以包括 <code>API</code> 的标题、描述、版本等信息。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@Slf4j</span><br><span class="line">@OpenAPIDefinition(info = @Info(title = &quot;内容管理系统&quot;, description = &quot;对课程相关信息进行管理&quot;, version = &quot;1.0.0&quot;))</span><br><span class="line">public class ContentApplication &#123;</span><br><span class="line">   </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">   </span><br><span class="line">        SpringApplication.run(ContentApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-Tag"><a href="#2-Tag" class="headerlink" title="2. @Tag"></a>2. @Tag</h2><p>用于对 <code>API</code> 进行分组。可以在控制器类或方法级别上使用。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Tag(name = &quot;课程信息编辑接口&quot;)</span><br><span class="line">@RestController(&quot;content&quot;)</span><br><span class="line">public class CourseBaseInfoController &#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-Operation"><a href="#3-Operation" class="headerlink" title="3. @Operation"></a>3. @Operation</h2><p>描述单个 <code>API</code> 操作（即一个请求映射方法）。可以提供操作的摘要、描述、标签等。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Operation(summary = &quot;课程查询接口&quot;)</span><br><span class="line">@PostMapping(&quot;/course/list&quot;)</span><br><span class="line">public PageResult&lt;CourseBase&gt; list(</span><br><span class="line">        PageParams params,</span><br><span class="line">        @RequestBody(required = false) QueryCourseParamsDto dto)&#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    CourseBase courseBase = new CourseBase();</span><br><span class="line">    courseBase.setCreateDate(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">    return new PageResult&lt;CourseBase&gt;(new ArrayList&lt;CourseBase&gt;(List.of(courseBase)),20, 2, 10);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/1718889437847.png" class="" title="This is an example image">

<h2 id="4-Parameter"><a href="#4-Parameter" class="headerlink" title="4. @Parameter"></a>4. @Parameter</h2><p>用于描述方法参数的额外信息，例如参数的描述、是否必需等。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Operation(summary = &quot;课程查询接口&quot;)</span><br><span class="line">@PostMapping(&quot;/course/list&quot;)</span><br><span class="line">public PageResult&lt;CourseBase&gt; list(</span><br><span class="line">        @Parameter(description = &quot;分页参数&quot;) PageParams params,</span><br><span class="line">        @Parameter(description = &quot;请求具体内容&quot;) @RequestBody(required = false) QueryCourseParamsDto dto)&#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    CourseBase courseBase = new CourseBase();</span><br><span class="line">    courseBase.setCreateDate(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">    return new PageResult&lt;CourseBase&gt;(new ArrayList&lt;CourseBase&gt;(List.of(courseBase)),20, 2, 10);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/1718889437964.png" class="" title="This is an example image">

<h2 id="5-Schema"><a href="#5-Schema" class="headerlink" title="5. @Schema"></a>5. @Schema</h2><p>描述模型的结构。可以用于类级别（标注在模型类上）或字段级别。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class PageParams &#123;</span><br><span class="line">   </span><br><span class="line">    //当前页码</span><br><span class="line">    @Schema(description = &quot;页码&quot;)</span><br><span class="line">    private Long pageNo = 1L;</span><br><span class="line"></span><br><span class="line">    //每页记录数默认值</span><br><span class="line">    @Schema(description = &quot;每页条目数量&quot;)</span><br><span class="line">    private Long pageSize =10L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/1718889438024.png" class="" title="This is an example image">

<h2 id="6-ApiResponse"><a href="#6-ApiResponse" class="headerlink" title="6. @ApiResponse"></a>6. @ApiResponse</h2><p>描述 <code>API</code> 响应的预期结果。可以指定状态码、描述以及返回类型。</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ApiResponse(responseCode = &quot;200&quot;, description = &quot;Successfully retrieved user&quot;)</span><br><span class="line">public User getUserById(@PathVariable Long id) &#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/Hexo/2024/01/23/2024-H1/2024-01-23-17-14-08/1718889438135.png" class="" title="This is an example image">

</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2024/01/06/2024-H1/2024-01-06-20-49-56/"><img class="fill" src="/Hexo/gallery/defaultCover3.png" alt="云服务器Docker部署SpringBoot+Vue前后端(Ubuntu)"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-01-06T20:49:56.000Z" title="1/6/2024, 8:49:56 PM">2024-01-06</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.206Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringBoot3/">SpringBoot3</a><span> / </span><a class="link-muted" href="/Hexo/categories/SpringBoot3/Docker/">Docker</a></span><span class="level-item">9 分钟读完 (大约1382个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2024/01/06/2024-H1/2024-01-06-20-49-56/">云服务器Docker部署SpringBoot+Vue前后端(Ubuntu)</a></p><div class="content"><p>本文创作环境<br>华为云Ubuntu22.04<br>需要对以下知识具备一定了解和经验</p>
<ul>
<li>Linux和Docker使用基础</li>
<li>Vue基本使用</li>
<li>SpringBoot基本使用</li>
</ul>
<h1 id="一、起手式-环境配置"><a href="#一、起手式-环境配置" class="headerlink" title="一、起手式-环境配置"></a>一、起手式-环境配置</h1><h2 id="1-远程服务器免密"><a href="#1-远程服务器免密" class="headerlink" title="1.远程服务器免密"></a>1.远程服务器免密</h2><p>在远程服务器执行<code>ssh-keygen -t rsa</code>,得到如下三个文件</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@hecs-295176:~# ls -lh .ssh/</span><br><span class="line">total 12K</span><br><span class="line">-rw------- 1 root root  570 Oct 21 15:14 authorized_keys</span><br><span class="line">-rw------- 1 root root 2.6K Oct 21 15:09 id_rsa</span><br><span class="line">-rw-r--r-- 1 root root  570 Oct 21 15:09 id_rsa.pub</span><br></pre></td></tr></table></figure>

<p>将<code>id_rsa.pub</code>内容复制到<code>authorized_keys</code>，然后将<code>id_rsa</code>下载到本地。<br>在VsCode使用Remote-SSH配置远程免密登录，例如</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host huaweiYun</span><br><span class="line">  HostName xxx.xxx.xxx.xxx</span><br><span class="line">  User root</span><br><span class="line">  Port 22</span><br><span class="line">  IdentityFile &quot;C:\Users\mumu\.ssh\id_rsa&quot;</span><br></pre></td></tr></table></figure>

<h2 id="2-安装Docker"><a href="#2-安装Docker" class="headerlink" title="2.安装Docker"></a>2.安装Docker</h2><p>执行以下命令安装Docker并检查docker命令是否可以使用</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt upgrade</span><br><span class="line">apt install docker.io</span><br><span class="line">docker ps -a</span><br><span class="line">docker images -a</span><br></pre></td></tr></table></figure>

<h1 id="二、Vue前端部署"><a href="#二、Vue前端部署" class="headerlink" title="二、Vue前端部署"></a>二、Vue前端部署</h1><h2 id="1-参考文件夹结构"><a href="#1-参考文件夹结构" class="headerlink" title="1.参考文件夹结构"></a>1.参考文件夹结构</h2><p>文件先不用创建，按照下面结构先把文件夹创建出来<br>然后将你的Vue打包后的dist文件夹替换下面的dist文件夹（如果没有Vue的打包文件夹本人建议先在index.html随便写点东西等会看能不能访问）</p>
<figure class="highlight plaintext"><figcaption><span>language-html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/root</span><br><span class="line">├── conf</span><br><span class="line">│   └── nginx</span><br><span class="line">│       ├── default.conf</span><br><span class="line">│       └── nginx.conf</span><br><span class="line">└── Vue</span><br><span class="line">    ├── MyTest01</span><br><span class="line">    │   ├── dist</span><br><span class="line">    │   │   └── index.html</span><br><span class="line">    │   └── logs</span><br><span class="line">    │       ├── access.log</span><br><span class="line">    │       └── error.log</span><br><span class="line">    └── nginxDocker.sh</span><br></pre></td></tr></table></figure>

<h2 id="2-nginx"><a href="#2-nginx" class="headerlink" title="2.nginx"></a>2.nginx</h2><p>拉取nginx镜像并创建nginx容器</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br><span class="line">docker run -itd  nginx</span><br></pre></td></tr></table></figure>

<p>把里面的两个配置文件复制到主机</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp containerName:/etc/nginx/nginx.conf ~/conf/nginx/nginx.conf</span><br><span class="line">docker cp containerName:/etc/nginx/conf.d/default.conf ~/conf/nginx/default.conf</span><br></pre></td></tr></table></figure>

<p>编辑default.conf 文件，修改以下内容：</p>
<ul>
<li>将 <code>listen 80;</code> 改为 <code>listen 8080;</code>，表示 nginx 容器监听 8080 端口。</li>
<li>将 <code>root /usr/share/nginx/html;</code> 改为 <code>root /usr/share/nginx/dist;</code>，表示 nginx容器的根目录为 <code>/usr/share/nginx/dist</code>。</li>
<li>将 <code>index index.html index.htm;</code> 改为 <code>index index.html;</code>，表示 nginx 容器的默认首页为 index.html。</li>
</ul>
<p>参考第一小步文件夹结构，把以下内容写入<code>nginxDocker.sh</code></p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">containerName=&quot;Test01&quot;</span><br><span class="line">nginxConf=&quot;/root/conf/nginx/nginx.conf&quot;</span><br><span class="line">defaultConf=&quot;/root/conf/nginx/default.conf&quot;</span><br><span class="line">logsPath=&quot;/root/Vue/MyTest01/logs&quot;</span><br><span class="line">vuePath=&quot;/root/Vue/MyTest01/dist&quot;</span><br><span class="line"></span><br><span class="line">docker run  -d --name &quot;$containerName&quot; \</span><br><span class="line">            -v &quot;$nginxConf&quot;:/etc/nginx/nginx.conf \</span><br><span class="line">            -v &quot;$defaultConf&quot;:/etc/nginx/conf.d/default.conf \</span><br><span class="line">            -v &quot;$logsPath&quot;:/var/log/nginx \</span><br><span class="line">            -v &quot;$vuePath&quot;:/usr/share/nginx/dist \</span><br><span class="line">            -p 8080:8080 \</span><br><span class="line">            nginx</span><br></pre></td></tr></table></figure>

<p>命令行运行这个sh脚本并查看当前容器列表确认容器已经在运行中</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash Vue/nginxDocker.sh</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h2 id="3-开放8080端口"><a href="#3-开放8080端口" class="headerlink" title="3.开放8080端口"></a>3.开放8080端口</h2><p>如果你使用的VsCode远程连接的服务器，那么可以先通过端口转发，在本地访问前端服务。<br>如果想要别人通过公网访问，需要去购买云服务器的平台，修改服务器的安全组配置，添加入站规则，开放<code>8080</code>端口。<br>之后使用IP+8080即可访问这个docker容器里的前端服务。</p>
<h2 id="4-复盘"><a href="#4-复盘" class="headerlink" title="4.复盘"></a>4.复盘</h2><p>首先是更新便捷性，使用-v挂载文件到容器，我们可以直接修改主机的dist文件夹内容而不必对容器做任何操作，前端服务就可以自动update，其它-v挂载的文件都可以在主机直接修改而不必连入容器中修改，同时重启容器即可一定保证所有服务重启。<br>其次是多开便捷性，以上流程就是一个包裹了前端服务的docker占一个端口，如果有多个Vue前端，使用不同端口即可。<br>总而言之，都是选择Docker容器化的优势所在。</p>
<h1 id="三、SpringBoot后端部署"><a href="#三、SpringBoot后端部署" class="headerlink" title="三、SpringBoot后端部署"></a>三、SpringBoot后端部署</h1><h2 id="1-参考文件夹结构-1"><a href="#1-参考文件夹结构-1" class="headerlink" title="1.参考文件夹结构"></a>1.参考文件夹结构</h2><p>将maven打包好的jar包如下图放入对应位置</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SpringBoot</span><br><span class="line">   ├── javaDocker.sh</span><br><span class="line">   └── MyTest01</span><br><span class="line">       └── demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<h2 id="2-openjdk17"><a href="#2-openjdk17" class="headerlink" title="2.openjdk17"></a>2.openjdk17</h2><p>以java17举例，拉取对应docker镜像（java8对应的镜像是java:8 ）</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull openjdk:17</span><br></pre></td></tr></table></figure>

<p>如下编写<code>javaDocker.sh</code>脚本</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">containerName=&quot;JavaTest01&quot;</span><br><span class="line">SpringBootPath=&quot;/root/SpringBoot/MyTest01/demo-0.0.1-SNAPSHOT.jar&quot;</span><br><span class="line"></span><br><span class="line">docker run  -d --name &quot;$containerName&quot; \</span><br><span class="line">            -p 8081:8081 \</span><br><span class="line">            -v &quot;$SpringBootPath&quot;:/app/your-app.jar \</span><br><span class="line">            openjdk:17 java -jar /app/your-app.jar</span><br></pre></td></tr></table></figure>

<p>命令行运行这个sh脚本并查看当前容器列表确认容器已经在运行中</p>
<figure class="highlight plaintext"><figcaption><span>language-bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash SpringBoot/javaDocker.sh</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h2 id="3-开放8081端口"><a href="#3-开放8081端口" class="headerlink" title="3.开放8081端口"></a>3.开放8081端口</h2><p>需要去购买云服务器的平台，修改服务器的安全组配置，添加入站规则，开放8081端口。<br>打开浏览器，输入IP:8081然后跟上一些你在程序中写的api路径，验证是否有返回。</p>
<h1 id="四、Vue-Axios-SpringBoot前后端通信简单实现"><a href="#四、Vue-Axios-SpringBoot前后端通信简单实现" class="headerlink" title="四、Vue-&gt;Axios-&gt;SpringBoot前后端通信简单实现"></a>四、Vue-&gt;Axios-&gt;SpringBoot前后端通信简单实现</h1><p>vue这里使用<strong>ts + setup +组合式</strong> 语法举例，前端代码如下<br>意思是向IP为xxx.xxx.xxx.xxx的云服务器的<code>8081</code>端口服务发送路径为<code>/Home/Kmo</code>的请求</p>
<figure class="highlight plaintext"><figcaption><span>language-html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    Your Remote JavaDocker State : &#123;</span><br><span class="line">  &#123; line &#125;&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">      ref &#125; from &quot;vue&quot;;</span><br><span class="line">import axios from &quot;axios&quot;;</span><br><span class="line">const line = ref(&quot;fail&quot;);</span><br><span class="line">axios.get(&quot;http://xxx.xxx.xxx.xxx:8081/Home/Kmo&quot;).then(rp=&gt;&#123;</span><br><span class="line">     </span><br><span class="line">  line.value = rp.data</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SpringBoot后端写一个简单Controller类，代码如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.kmo.demo.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@CrossOrigin(originPatterns = &quot;*&quot;, allowCredentials = &quot;true&quot;)</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;Home&quot;)</span><br><span class="line">public class TestController &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/Kmo&quot;)</span><br><span class="line">    public String test()&#123;</span><br><span class="line">   </span><br><span class="line">        return &quot;Success!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分别打包放到云服务指定文件夹，然后<code>restart</code>重启两个docker容器即可，在本地浏览器访问IP:8080看看效果吧。</p>
<p>(完)</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/Hexo/2023/12/01/2023-H2/2023-12-01-14-49-31/"><img class="fill" src="/Hexo/gallery/defaultCover5.png" alt="JavaWeb MyBatisPlus添加一个能够批量插入的Mapper通用方法"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:49:31.000Z" title="12/1/2023, 2:49:31 PM">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2024-08-11T07:21:48.186Z" title="8/11/2024, 7:21:48 AM">2024-08-11</time>更新</span><span class="level-item"> Xiamu </span><span class="level-item"><a class="link-muted" href="/Hexo/categories/SpringBoot2/">SpringBoot2</a></span><span class="level-item">11 分钟读完 (大约1611个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Hexo/2023/12/01/2023-H2/2023-12-01-14-49-31/">JavaWeb MyBatisPlus添加一个能够批量插入的Mapper通用方法</a></p><div class="content"><p>众所周知，mybatisplus提供的BaseMapper里只有单条插入的方法，没有批量插入的方法，<br>而在Service层的批量插入并不是真的批量插入，实际上是遍历insert，但也不是一次insert就一次IO，而是到一定数量才会去IO一次，性能不是很差，但也不够好。</p>
<p>怎么才能实现真正的批量插入呢？</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-deluxe">这里是mybatisplus官方的演示仓库，可以先去了解一下。</a></p>
<h1 id="一、注册自定义通用方法流程"><a href="#一、注册自定义通用方法流程" class="headerlink" title="一、注册自定义通用方法流程"></a>一、注册自定义通用方法流程</h1><ol>
<li>把自定义方法写到BaseMapper，因为没法改BaseMapper，所以继承一下它</li>
</ol>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface MyBaseMapper&lt;T&gt; extends BaseMapper&lt;T&gt; &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    int batchInsert(@Param(&quot;list&quot;) List&lt;T&gt; entityList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBaseMapper扩展了原有的BaseMapper，所以你之后的Mapper层都继承自MyBaseMapper而不是BaseMapper即可。</p>
<ol start="2">
<li>把通用方法注册到mybatisplus</li>
</ol>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MySqlInjector extends DefaultSqlInjector &#123;</span><br><span class="line">   </span><br><span class="line">	@Override</span><br><span class="line">	public List&lt;AbstractMethod&gt; getMethodList(Class&lt;?&gt; mapperClass, TableInfo tableInfo) &#123;</span><br><span class="line">   </span><br><span class="line">		List&lt;AbstractMethod&gt; defaultMethodList = super.getMethodList(mapperClass, tableInfo);</span><br><span class="line">		defaultMethodList.add(new BatchInsert(&quot;batchInsert&quot;));</span><br><span class="line">		return defaultMethodList;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键的一句在于<code>defaultMethodList.add(new BatchInsert(&quot;batchInsert&quot;));</code>，意为注册一个新的方法叫<code>batchInsert</code>，具体实现在<code>BatchInsert</code>类。</p>
<ol start="3">
<li>实现BatchInsert类</li>
</ol>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">public class BatchInsert extends AbstractMethod &#123;</span><br><span class="line">   </span><br><span class="line">	public BatchInsert(String name) &#123;</span><br><span class="line">   </span><br><span class="line">		super(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public MappedStatement injectMappedStatement(Class&lt;?&gt; mapperClass, Class&lt;?&gt; modelClass, TableInfo tableInfo) &#123;</span><br><span class="line">   </span><br><span class="line">		KeyGenerator keyGenerator = NoKeyGenerator.INSTANCE;</span><br><span class="line">		SqlMethod sqlMethod = SqlMethod.INSERT_ONE;</span><br><span class="line">		String columnScript = getAllInsertSqlColumn(tableInfo.getFieldList());</span><br><span class="line">		String valuesScript = SqlScriptUtils.convertForeach(LEFT_BRACKET + getAllInsertSqlProperty(&quot;item.&quot;, tableInfo.getFieldList()) + RIGHT_BRACKET,</span><br><span class="line">				LIST, null, &quot;item&quot;, COMMA);</span><br><span class="line">		String keyProperty = null;</span><br><span class="line">		String keyColumn = null;</span><br><span class="line">		// 表包含主键处理逻辑,如果不包含主键当普通字段处理</span><br><span class="line">		if (StringUtils.isNotBlank(tableInfo.getKeyProperty())) &#123;</span><br><span class="line">   </span><br><span class="line">			if (tableInfo.getIdType() == IdType.AUTO) &#123;</span><br><span class="line">   </span><br><span class="line">				/* 自增主键 */</span><br><span class="line">				keyGenerator = Jdbc3KeyGenerator.INSTANCE;</span><br><span class="line">				keyProperty = tableInfo.getKeyProperty();</span><br><span class="line">				// 去除转义符</span><br><span class="line">				keyColumn = SqlInjectionUtils.removeEscapeCharacter(tableInfo.getKeyColumn());</span><br><span class="line">			&#125; else if (null != tableInfo.getKeySequence()) &#123;</span><br><span class="line">   </span><br><span class="line">				keyGenerator = TableInfoHelper.genKeyGenerator(methodName, tableInfo, builderAssistant);</span><br><span class="line">				keyProperty = tableInfo.getKeyProperty();</span><br><span class="line">				keyColumn = tableInfo.getKeyColumn();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		String sql = String.format(sqlMethod.getSql(), tableInfo.getTableName(), columnScript, valuesScript);</span><br><span class="line">		SqlSource sqlSource = super.createSqlSource(configuration, sql, modelClass);</span><br><span class="line">		return this.addInsertMappedStatement(mapperClass, modelClass, methodName, sqlSource, keyGenerator, keyProperty, keyColumn);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 获取 insert 时所有列名组成的sql片段</span><br><span class="line">	 * @param fieldList 表字段信息列表</span><br><span class="line">	 * @return sql 脚本片段</span><br><span class="line">	 */</span><br><span class="line">	private String getAllInsertSqlColumn(List&lt;TableFieldInfo&gt; fieldList) &#123;</span><br><span class="line">   </span><br><span class="line">		return LEFT_BRACKET + fieldList.stream()</span><br><span class="line">				.map(TableFieldInfo::getColumn).filter(Objects::nonNull).collect(joining(COMMA + NEWLINE)) + RIGHT_BRACKET;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 获取 insert 时所有属性值组成的sql片段</span><br><span class="line">	 * @param prefix 前缀</span><br><span class="line">	 * @param fieldList 表字段信息列表</span><br><span class="line">	 * @return sql 脚本片段</span><br><span class="line">	 */</span><br><span class="line">	private String getAllInsertSqlProperty(final String prefix, List&lt;TableFieldInfo&gt; fieldList) &#123;</span><br><span class="line">   </span><br><span class="line">		final String newPrefix = prefix == null ? EMPTY : prefix;</span><br><span class="line">		return fieldList.stream()</span><br><span class="line">				.map(i -&gt; i.getInsertSqlProperty(newPrefix).replace(&quot;,&quot;, &quot;&quot;))</span><br><span class="line">				.filter(Objects::nonNull)</span><br><span class="line">				.collect(joining(COMMA + NEWLINE));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="二、BatchInsert具体实现逻辑解析"><a href="#二、BatchInsert具体实现逻辑解析" class="headerlink" title="二、BatchInsert具体实现逻辑解析"></a>二、BatchInsert具体实现逻辑解析</h1><p>以如下简单的表<code>user</code>举例，</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>描述</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>主键,自增</td>
<td>bigint</td>
</tr>
<tr>
<td>user_name</td>
<td>用户名</td>
<td>varchar(64)</td>
</tr>
<tr>
<td>user_age</td>
<td>用户年龄</td>
<td>int</td>
</tr>
</tbody></table>
<p>对于的<code>entity</code>大抵如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@EqualsAndHashCode(callSuper = true)</span><br><span class="line">@Accessors(chain = true)</span><br><span class="line">@TableName(&quot;user&quot;)</span><br><span class="line">public class User&#123;</span><br><span class="line">   </span><br><span class="line">	@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span><br><span class="line">    private Long id;</span><br><span class="line">    private String userName;</span><br><span class="line">    private int userAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么对于<code>batchInsert</code>，我们希望传入<code>List&lt;User&gt;</code>并希望得到类似如下的<code>mybtaisplus xml sql</code>语句</p>
<figure class="highlight plaintext"><figcaption><span>language-xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;batchInsert&quot; parameterType=&quot;java.util.List&quot;&gt;</span><br><span class="line">    insert into user(</span><br><span class="line">        id,</span><br><span class="line">        user_name,</span><br><span class="line">        user_age</span><br><span class="line">    )values</span><br><span class="line">    &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">    (   </span><br><span class="line">    	#&#123;item.id&#125;,</span><br><span class="line">        #&#123;item.userName&#125;,</span><br><span class="line">        #&#123;item.userAge&#125;</span><br><span class="line">    )</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<p>但是我们并不自己写这个<code>xml</code>，不然这需要对每一个数据表都要写一个，就像不那么硬的硬代码一样，我们希望有段逻辑，只需要传入<code>entity</code>，就能自己解析其中列名和对应的属性名，生成这段<code>xml</code>实现批量插入的功能。</p>
<p>假设你的<code>UserMapper</code>已经继承自<code>MyBaseMapper</code>，如果调用<code>UserMapper.bacthInsert(List&lt;User&gt; entityList)</code>，那么会进入这个函数</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public MappedStatement injectMappedStatement(Class&lt;?&gt; mapperClass, Class&lt;?&gt; modelClass, TableInfo tableInfo)</span><br></pre></td></tr></table></figure>

<p>其中<code>mapperClass</code>是映射器类，<code>modelClass</code>是模型类，我们并不需要了解，最主要的是<code>tableInfo</code>，这是表信息，它包含了关于数据库表的各种信息，如表名、列名、主键等。这个参数提供了详细的表信息，这对于生成针对特定表的SQL语句是必要的。</p>
<p>然后执行如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//如果你的表名没有主键，那么你需要指定keyGenerator 为NoKeyGenerator，</span><br><span class="line">//因为重写injectMappedStatement最后需要返回return this.addInsertMappedStatement</span><br><span class="line">//其中就需要KeyGenerator </span><br><span class="line">KeyGenerator keyGenerator = NoKeyGenerator.INSTANCE;</span><br><span class="line">//SqlMethod.INSERT_ONE就是&quot;INSERT INTO %s %s VALUES %s&quot;</span><br><span class="line">//我们依据表的信息生成列名sql片段和属性名sql片段后填入%s就可以得到近似最后的xml sql</span><br><span class="line">SqlMethod sqlMethod = SqlMethod.INSERT_ONE;</span><br></pre></td></tr></table></figure>

<p>然后执行如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//tableInfo.getFieldList()会得到一个包含数据表列信息(不包含主键)的TableFieldInfo类组成的List</span><br><span class="line">String columnScript = getAllInsertSqlColumn(tableInfo.getFieldList());</span><br><span class="line">//这行代码就是在调用这个函数</span><br><span class="line">private String getAllInsertSqlColumn(List&lt;TableFieldInfo&gt; fieldList) &#123;</span><br><span class="line">   </span><br><span class="line">	return LEFT_BRACKET + fieldList.stream()</span><br><span class="line">			//从TableFieldInfo中只拿取列名</span><br><span class="line">			.map(TableFieldInfo::getColumn)</span><br><span class="line">			//过滤null</span><br><span class="line">			.filter(Objects::nonNull)</span><br><span class="line">			//在元素间以逗号和分行分割</span><br><span class="line">			.collect(joining(COMMA + NEWLINE)) + RIGHT_BRACKET;</span><br><span class="line">&#125;</span><br><span class="line">//对于User表，这个函数返回以下String</span><br><span class="line">/*</span><br><span class="line">(user_name,</span><br><span class="line">user_age)</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>然后执行如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">//首先调用了getAllInsertSqlProperty</span><br><span class="line">String valuesScript = SqlScriptUtils.convertForeach(</span><br><span class="line">	// 这也是个内置函数，可以直接去看看</span><br><span class="line">	LEFT_BRACKET + getAllInsertSqlProperty(&quot;item.&quot;, tableInfo.getFieldList()) + RIGHT_BRACKET,</span><br><span class="line">	LIST, </span><br><span class="line">	null, </span><br><span class="line">	&quot;item&quot;, </span><br><span class="line">	COMMA</span><br><span class="line">);</span><br><span class="line">//LEFT_BRACKET + getAllInsertSqlProperty(&quot;item.&quot;, tableInfo.getFieldList()) + RIGHT_BRACKET</span><br><span class="line">//得到</span><br><span class="line">/*</span><br><span class="line">(#&#123;userName&#125;,</span><br><span class="line">#&#123;userAge&#125;)</span><br><span class="line">*/</span><br><span class="line">//经过convertForeach函数后，得到如下字符串</span><br><span class="line">/*</span><br><span class="line">&lt;foreach collection=&quot;list&quot; item=&quot;item&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">(#&#123;userName&#125;,</span><br><span class="line">#&#123;userAge&#125;)</span><br><span class="line"> &lt;/foreach&gt;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">//getAllInsertSqlProperty函数如下</span><br><span class="line">private String getAllInsertSqlProperty(final String prefix, List&lt;TableFieldInfo&gt; fieldList) &#123;</span><br><span class="line">   </span><br><span class="line">	//这里newPrefix 就是&quot;item.&quot;</span><br><span class="line">	final String newPrefix = prefix == null ? EMPTY : prefix;</span><br><span class="line">	return fieldList.stream()</span><br><span class="line">			//i.getInsertSqlProperty(&quot;item.&quot;)是内置函数，假设i现在遍历到了user_name列</span><br><span class="line">			//那么得到的就是&quot;#&#123;userName&#125;,&quot;</span><br><span class="line">			//然后,被删了</span><br><span class="line">			//所以本来每个元素从TableFieldInfo变成了形如&quot;#&#123;userName&#125;&quot;的字符串</span><br><span class="line">			.map(i -&gt; i.getInsertSqlProperty(newPrefix).replace(&quot;,&quot;, &quot;&quot;))</span><br><span class="line">			.filter(Objects::nonNull)</span><br><span class="line">			//在元素间插入逗号和分行</span><br><span class="line">			.collect(joining(COMMA + NEWLINE));</span><br><span class="line">&#125;</span><br><span class="line">//对于User表，这个函数返回以下String</span><br><span class="line">/*</span><br><span class="line">#&#123;userName&#125;,</span><br><span class="line">#&#123;userAge&#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>然后执行如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">		//定义主键属性名</span><br><span class="line">		String keyProperty = null;</span><br><span class="line">		//定义主键列名</span><br><span class="line">		String keyColumn = null;</span><br><span class="line">		// 表包含主键处理逻辑,如果不包含主键当普通字段处理</span><br><span class="line">		if (StringUtils.isNotBlank(tableInfo.getKeyProperty())) &#123;</span><br><span class="line">   </span><br><span class="line">			if (tableInfo.getIdType() == IdType.AUTO) &#123;</span><br><span class="line">   </span><br><span class="line">				/* 自增主键 */</span><br><span class="line">				keyGenerator = Jdbc3KeyGenerator.INSTANCE;</span><br><span class="line">				keyProperty = tableInfo.getKeyProperty();</span><br><span class="line">				// 去除转义符</span><br><span class="line">				keyColumn = SqlInjectionUtils.removeEscapeCharacter(tableInfo.getKeyColumn());</span><br><span class="line">			&#125; else if (null != tableInfo.getKeySequence()) &#123;</span><br><span class="line">   </span><br><span class="line">				keyGenerator = TableInfoHelper.genKeyGenerator(methodName, tableInfo, builderAssistant);</span><br><span class="line">				keyProperty = tableInfo.getKeyProperty();</span><br><span class="line">				keyColumn = tableInfo.getKeyColumn();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">//这段代码没什么好说的，就是根据不同情况，得到三个变量</span><br><span class="line">//keyGenerator keyProperty keyColumn </span><br></pre></td></tr></table></figure>

<p>然后执行如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String sql = String.format(sqlMethod.getSql(), tableInfo.getTableName(), columnScript, valuesScript);</span><br><span class="line">//就是把表名user，列名片段，属性名片段，填入%s中，得到如下</span><br><span class="line">/*</span><br><span class="line">INSERT INTO user (user_name,</span><br><span class="line">user_age) VALUES &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">(#&#123;userName&#125;,</span><br><span class="line">#&#123;userAge&#125;)</span><br><span class="line"> &lt;/foreach&gt;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>然后执行如下</p>
<figure class="highlight plaintext"><figcaption><span>language-java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//这两句没有什么可说的，是重写injectMappedStatement函数的必要的操作</span><br><span class="line">//自定义的内容就在于sql和主键</span><br><span class="line">SqlSource sqlSource = super.createSqlSource(configuration, sql, modelClass);</span><br><span class="line">return this.addInsertMappedStatement(mapperClass, modelClass, methodName, sqlSource, keyGenerator, keyProperty, keyColumn);</span><br></pre></td></tr></table></figure>


</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/Hexo/img/avatar.png" alt="Xiamu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Xiamu</p><p class="is-size-6 is-block">IT Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/Hexo/archives"><p class="title">120</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/Hexo/categories"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/Hexo/tags"><p class="title">98</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Xiamu-ssr" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/Xiamu-ssr"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/Hexo/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Hexo/categories/Front-End/"><span class="level-start"><span class="level-item">Front-End</span></span><span class="level-end"><span class="level-item tag">12</span></span></a><ul><li><a class="level is-mobile" href="/Hexo/categories/Front-End/Nginx/"><span class="level-start"><span class="level-item">Nginx</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/Front-End/Vue/"><span class="level-start"><span class="level-item">Vue</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Hexo/categories/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/JavaSE/"><span class="level-start"><span class="level-item">JavaSE</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringBoot2/"><span class="level-start"><span class="level-item">SpringBoot2</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringBoot3/"><span class="level-start"><span class="level-item">SpringBoot3</span></span><span class="level-end"><span class="level-item tag">20</span></span></a><ul><li><a class="level is-mobile" href="/Hexo/categories/SpringBoot3/Docker/"><span class="level-start"><span class="level-item">Docker</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringBoot3/MyBatisPlus/"><span class="level-start"><span class="level-item">MyBatisPlus</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringBoot3/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringBoot3/OpenAPI3/"><span class="level-start"><span class="level-item">OpenAPI3</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/"><span class="level-start"><span class="level-item">SpringCloud</span></span><span class="level-end"><span class="level-item tag">55</span></span></a><ul><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Elasticsearch/"><span class="level-start"><span class="level-item">Elasticsearch</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Gateway/"><span class="level-start"><span class="level-item">Gateway</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Kafka/"><span class="level-start"><span class="level-item">Kafka</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Minio/"><span class="level-start"><span class="level-item">Minio</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Nacos/"><span class="level-start"><span class="level-item">Nacos</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/OpenFeign/"><span class="level-start"><span class="level-item">OpenFeign</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/RabbitMQ/"><span class="level-start"><span class="level-item">RabbitMQ</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/RuoYi-Cloud-Plus/"><span class="level-start"><span class="level-item">RuoYi-Cloud-Plus</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/Seata/"><span class="level-start"><span class="level-item">Seata</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/xxl-job/"><span class="level-start"><span class="level-item">xxl-job</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84/"><span class="level-start"><span class="level-item">多级缓存架构</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/%E6%94%AF%E4%BB%98/"><span class="level-start"><span class="level-item">支付</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/SpringCloud/%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83/"><span class="level-start"><span class="level-item">认证授权</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Hexo/categories/Utils/"><span class="level-start"><span class="level-item">Utils</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/%E5%85%B6%E4%BB%96/"><span class="level-start"><span class="level-item">其他</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="level-start"><span class="level-item">大数据</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Hexo/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/"><span class="level-start"><span class="level-item">未分类</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/Hexo/tags/Consumer/"><span class="tag">Consumer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/JWT/"><span class="tag">JWT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/Kafka/"><span class="tag">Kafka</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/Nginx/"><span class="tag">Nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/OAuth2-1/"><span class="tag">OAuth2.1</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/RSA/"><span class="tag">RSA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/Spring-Security/"><span class="tag">Spring Security</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/Vue3/"><span class="tag">Vue3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/ambari/"><span class="tag">ambari</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/c/"><span class="tag">c++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/css3/"><span class="tag">css3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/docker/"><span class="tag">docker</span><span class="tag">29</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/echarts/"><span class="tag">echarts</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/ecmascript/"><span class="tag">ecmascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/elasticsearch/"><span class="tag">elasticsearch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/excel/"><span class="tag">excel</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/gateway/"><span class="tag">gateway</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/github/"><span class="tag">github</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/hadoop/"><span class="tag">hadoop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/hdfs/"><span class="tag">hdfs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/intellij-idea/"><span class="tag">intellij-idea</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/java/"><span class="tag">java</span><span class="tag">25</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/javascript/"><span class="tag">javascript</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/jenkins/"><span class="tag">jenkins</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/jvm/"><span class="tag">jvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/kafka/"><span class="tag">kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/linux/"><span class="tag">linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/md/"><span class="tag">md</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/mybatis/"><span class="tag">mybatis</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/mysql/"><span class="tag">mysql</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/nginx/"><span class="tag">nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/openresty/"><span class="tag">openresty</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/postman/"><span class="tag">postman</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/rabbitmq/"><span class="tag">rabbitmq</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/redis/"><span class="tag">redis</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/restful/"><span class="tag">restful</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/ruby/"><span class="tag">ruby</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/ruoyi/"><span class="tag">ruoyi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/spring/"><span class="tag">spring</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/spring-boot/"><span class="tag">spring boot</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/spring-cloud/"><span class="tag">spring cloud</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/spring-security/"><span class="tag">spring security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/springamqp/"><span class="tag">springamqp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/springboot/"><span class="tag">springboot</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/springcloud/"><span class="tag">springcloud</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/typescript/"><span class="tag">typescript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/vue/"><span class="tag">vue</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/vue-js/"><span class="tag">vue.js</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/web/"><span class="tag">web</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/web%E5%AE%89%E5%85%A8/"><span class="tag">web安全</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/windows/"><span class="tag">windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/word/"><span class="tag">word</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/zookeeper/"><span class="tag">zookeeper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"><span class="tag">个人博客</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E4%BA%8B%E5%8A%A1/"><span class="tag">事务</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%88%86%E5%8C%BA/"><span class="tag">分区</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"><span class="tag">分布式</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><span class="tag">分布式文件系统</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"><span class="tag">单例模式</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%8D%9A%E5%AE%A2/"><span class="tag">博客</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%8F%8C%E6%A3%80%E9%94%81/"><span class="tag">双检锁</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"><span class="tag">反向代理</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%90%8E%E7%AB%AF/"><span class="tag">后端</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="tag">大数据</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%AD%98%E5%82%A8/"><span class="tag">存储</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%AE%B9%E5%99%A8/"><span class="tag">容器</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%B9%82%E7%AD%89/"><span class="tag">幂等</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/"><span class="tag">开发语言</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="tag">微服务</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/"><span class="tag">拦截器</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"><span class="tag">排序算法</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%94%AF%E4%BB%98/"><span class="tag">支付</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%94%AF%E4%BB%98%E5%AE%9D/"><span class="tag">支付宝</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">数据库</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><span class="tag">文件系统</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"><span class="tag">服务器</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%9C%AA%E5%88%86%E7%B1%BB/"><span class="tag">未分类</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%9E%9A%E4%B8%BE%E5%8D%95%E4%BE%8B/"><span class="tag">枚举单例</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%9E%B6%E6%9E%84/"><span class="tag">架构</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><span class="tag">正则表达式</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E6%B6%88%E8%B4%B9%E8%80%85/"><span class="tag">消费者</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E7%88%AC%E8%99%AB/"><span class="tag">爬虫</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E7%94%9F%E4%BA%A7%E8%80%85/"><span class="tag">生产者</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E7%BC%93%E5%AD%98/"><span class="tag">缓存</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E7%BD%91%E7%AB%99/"><span class="tag">网站</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E8%A7%86%E9%A2%91/"><span class="tag">视频</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"><span class="tag">负载均衡</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E8%BF%90%E7%BB%B4/"><span class="tag">运维</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E9%87%8D%E6%9E%84/"><span class="tag">重构</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E9%94%81/"><span class="tag">锁</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Hexo/tags/%E9%9B%86%E7%BE%A4/"><span class="tag">集群</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/Hexo/2024/07/31/2024-H2/2024-07-31-18-11-56/"><img src="/Hexo/gallery/defaultThumbnail4.png" alt="Kafka 更多延伸讨论"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-07-31T18:11:58.000Z">2024-07-31</time></p><p class="title"><a href="/Hexo/2024/07/31/2024-H2/2024-07-31-18-11-56/">Kafka 更多延伸讨论</a></p><p class="categories"><a href="/Hexo/categories/SpringCloud/">SpringCloud</a> / <a href="/Hexo/categories/SpringCloud/Kafka/">Kafka</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Hexo/2024/07/30/2024-H2/2024-07-30-18-58-27/"><img src="/Hexo/gallery/defaultThumbnail1.png" alt="Kafka Consumer"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-07-30T18:58:30.000Z">2024-07-30</time></p><p class="title"><a href="/Hexo/2024/07/30/2024-H2/2024-07-30-18-58-27/">Kafka Consumer</a></p><p class="categories"><a href="/Hexo/categories/SpringCloud/">SpringCloud</a> / <a href="/Hexo/categories/SpringCloud/Kafka/">Kafka</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Hexo/2024/07/20/2024-H2/2024-07-20-19-59-46/"><img src="/Hexo/gallery/defaultThumbnail2.png" alt="Kafka之存储设计"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-07-20T19:59:49.000Z">2024-07-20</time></p><p class="title"><a href="/Hexo/2024/07/20/2024-H2/2024-07-20-19-59-46/">Kafka之存储设计</a></p><p class="categories"><a href="/Hexo/categories/SpringCloud/">SpringCloud</a> / <a href="/Hexo/categories/SpringCloud/Kafka/">Kafka</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Hexo/2024/07/19/2024-H2/2024-07-19-21-29-10/"><img src="/Hexo/gallery/defaultThumbnail7.png" alt="Kafka Producer之事务性"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-07-19T21:29:12.000Z">2024-07-19</time></p><p class="title"><a href="/Hexo/2024/07/19/2024-H2/2024-07-19-21-29-10/">Kafka Producer之事务性</a></p><p class="categories"><a href="/Hexo/categories/SpringCloud/">SpringCloud</a> / <a href="/Hexo/categories/SpringCloud/Kafka/">Kafka</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Hexo/2024/07/18/2024-H2/2024-07-18-21-10-28/"><img src="/Hexo/gallery/defaultThumbnail1.png" alt="Kafka Producer之幂等性"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-07-18T21:10:29.000Z">2024-07-18</time></p><p class="title"><a href="/Hexo/2024/07/18/2024-H2/2024-07-18-21-10-28/">Kafka Producer之幂等性</a></p><p class="categories"><a href="/Hexo/categories/SpringCloud/">SpringCloud</a> / <a href="/Hexo/categories/SpringCloud/Kafka/">Kafka</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Hexo/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/Hexo/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/Hexo/"><img src="/Hexo/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2024 Xiamu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2024 Xiamu ❄️</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/Hexo/js/column.js"></script><script src="/Hexo/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/Hexo/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/Hexo/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/Hexo/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/Hexo/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/Hexo/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>